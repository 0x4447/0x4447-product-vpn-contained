{
	"CloudWatchDashboard": {
		"Type": "AWS::CloudWatch::Dashboard",
		"Properties": {
			"DashboardName": { "Ref": "AWS::StackName" },
			"DashboardBody": {
				"Fn::Sub": [
					"{\r\n    \"widgets\": [\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 9,\r\n            \"y\": 0,\r\n            \"width\": 15,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"AWS\/EC2\", \"NetworkIn\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"stat\": \"Sum\", \"color\": \"#1f77b4\", \"label\": \"RX\" } ],\r\n                    [ \".\", \"NetworkOut\", \".\", \".\", { \"yAxis\": \"left\", \"stat\": \"Sum\", \"color\": \"#ff7f0e\", \"label\": \"TX\" } ]\r\n                ],\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": true,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"Network In & Out\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 9,\r\n            \"y\": 3,\r\n            \"width\": 15,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"AWS\/ECS\", \"CPUUtilization\", \"ClusterName\", \"${ClusterName}\", { \"yAxis\": \"left\", \"label\": \"ECS\" } ],\r\n                    [ \"AWS\/EC2\", \".\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"label\": \"EC2\" } ]\r\n                ],\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": true,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"EC2 CPU Time\",\r\n                \"period\": 300,\r\n                \"legend\": {\r\n                    \"position\": \"bottom\"\r\n                },\r\n                \"yAxis\": {\r\n                    \"left\": {\r\n                        \"label\": \"\",\r\n                        \"showUnits\": true\r\n                    },\r\n                    \"right\": {\r\n                        \"label\": \"\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 0,\r\n            \"width\": 9,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"AWS\/EC2\", \"NetworkOut\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"yAxis\": \"right\", \"id\": \"m2\", \"stat\": \"Sum\", \"period\": 2592000, \"color\": \"#ff7f0e\", \"label\": \"TX\" } ],\r\n                    [ \".\", \"NetworkIn\", \".\", \".\", { \"id\": \"m1\", \"stat\": \"Sum\", \"period\": 2592000, \"color\": \"#1f77b4\", \"label\": \"RX\" } ]\r\n                ],\r\n                \"view\": \"singleValue\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"Total traffic\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 15,\r\n            \"y\": 9,\r\n            \"width\": 9,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"CWAgent\", \"mem_used\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#ff7f0e\", \"label\": \"Used\" } ],\r\n                    [ \".\", \"mem_available\", \".\", \".\", { \"color\": \"#2ca02c\", \"label\": \"Available\" } ]\r\n                ],\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"RAM\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 9,\r\n            \"width\": 15,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"CWAgent\", \"mem_total\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#d62728\", \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Total\" } ],\r\n                    [ \".\", \"mem_used\", \".\", \".\", { \"color\": \"#ff7f0e\", \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Used\" } ],\r\n                    [ \".\", \"mem_available\", \".\", \".\", { \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Available\" } ]\r\n                ],\r\n                \"view\": \"singleValue\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"RAM\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 15,\r\n            \"y\": 15,\r\n            \"width\": 9,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"CWAgent\", \"processes_running\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#2ca02c\", \"label\": \"Running\" } ],\r\n                    [ \".\", \"processes_sleeping\", \".\", \".\", { \"label\": \"Sleeping\" } ],\r\n                    [ \".\", \"processes_dead\", \".\", \".\", { \"color\": \"#8c564b\", \"label\": \"Dead\" } ]\r\n                ],\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"Processes\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 15,\r\n            \"width\": 15,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"CWAgent\", \"processes_running\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#d62728\", \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Running\" } ],\r\n                    [ \".\", \"processes_dead\", \".\", \".\", { \"color\": \"#ff7f0e\", \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Dead\" } ],\r\n                    [ \".\", \"processes_sleeping\", \".\", \".\", { \"period\": 2592000, \"stat\": \"Maximum\", \"color\": \"#2ca02c\", \"label\": \"Sleeping\" } ]\r\n                ],\r\n                \"view\": \"singleValue\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"Processes\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 15,\r\n            \"y\": 12,\r\n            \"width\": 9,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"CWAgent\", \"disk_used\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#ff7f0e\", \"label\": \"Used\" } ],\r\n                    [ \".\", \"disk_free\", \".\", \".\", { \"color\": \"#2ca02c\", \"label\": \"Available\" } ]\r\n                ],\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"HDD\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 12,\r\n            \"width\": 15,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"CWAgent\", \"disk_total\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#d62728\", \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Total\" } ],\r\n                    [ \".\", \"disk_used\", \".\", \".\", { \"color\": \"#ff7f0e\", \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Used\" } ],\r\n                    [ \".\", \"disk_free\", \".\", \".\", { \"period\": 2592000, \"stat\": \"Maximum\", \"label\": \"Available\" } ]\r\n                ],\r\n                \"view\": \"singleValue\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"HDD\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 18,\r\n            \"width\": 24,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"AWS\/Logs\", \"IncomingLogEvents\", \"LogGroupName\", \"\/var\/log\/dmesg\" ],\r\n                    [ \"...\", \"\/var\/log\/docker\" ],\r\n                    [ \"...\", \"\/var\/log\/ecs\/audit.log\" ],\r\n                    [ \"...\", \"\/var\/log\/ecs\/ecs-agent.log\" ],\r\n                    [ \"...\", \"\/var\/log\/messages\" ]\r\n                ],\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"Logs Intake\",\r\n                \"period\": 300\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 6,\r\n            \"width\": 24,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"view\": \"timeSeries\",\r\n                \"stacked\": false,\r\n                \"metrics\": [\r\n                    [ \"AWS\/EC2\", \"CPUSurplusCreditsCharged\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\" ],\r\n                    [ \".\", \"CPUSurplusCreditBalance\", \".\", \".\" ],\r\n                    [ \".\", \"CPUCreditUsage\", \".\", \".\" ]\r\n                ],\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"EC2 CPU Burst\"\r\n            }\r\n        },\r\n        {\r\n            \"type\": \"metric\",\r\n            \"x\": 0,\r\n            \"y\": 3,\r\n            \"width\": 9,\r\n            \"height\": 3,\r\n            \"properties\": {\r\n                \"metrics\": [\r\n                    [ \"AWS\/EC2\", \"CPUUtilization\", \"AutoScalingGroupName\", \"${AutoScalingGroupName}\", { \"color\": \"#ff7f0e\", \"label\": \"EC2\" } ],\r\n                    [ \"AWS\/ECS\", \".\", \"ClusterName\", \"${ClusterName}\", { \"yAxis\": \"left\", \"color\": \"#1f77b4\", \"label\": \"ECS\" } ]\r\n                ],\r\n                \"view\": \"singleValue\",\r\n                \"stacked\": false,\r\n                \"region\": \"us-east-1\",\r\n                \"title\": \"EC2 CPU Time\",\r\n                \"period\": 300,\r\n                \"legend\": {\r\n                    \"position\": \"bottom\"\r\n                },\r\n                \"yAxis\": {\r\n                    \"left\": {\r\n                        \"label\": \"\",\r\n                        \"showUnits\": true\r\n                    },\r\n                    \"right\": {\r\n                        \"label\": \"\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    ]\r\n}",
					{
						"AutoScalingGroupName": { "Ref": "EC2AutoScalingGroup" },
						"ClusterName": { "Ref": "AWS::StackName" }
					}
				]
			}
		}
	}
}